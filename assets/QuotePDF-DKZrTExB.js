import{j as e,f as ee,t as he,p as ue,c as pe,z as ye}from"./index-BG84GOAW.js";import{Document as xe,Page as q,StyleSheet as be,View as s,Image as v,Text as i}from"./react-pdf.browser-BH20xT6H.js";const _e="/assets/portaFinestra-D2PEi5_2.png",je="/assets/scorrevole-fwxVE2rR.png",K="/assets/x-infissi-logo-Cv6BEoAX.png",r=be.create({page:{padding:38,fontSize:11,color:"#111"},row:{flexDirection:"row"},col:{flexGrow:1},h1:{fontSize:32,fontWeight:700,marginBottom:4},h2:{fontSize:13,fontWeight:700,marginTop:14,marginBottom:6},h2Tight:{fontSize:13,fontWeight:700,marginTop:0,marginBottom:4},label:{color:"#555"},box:{borderWidth:1,borderStyle:"solid",borderColor:"#e6e6e6",borderRadius:6,padding:8},table:{borderWidth:1,borderStyle:"solid",borderColor:"#e6e6e6",borderRadius:6,marginTop:8},tr:{flexDirection:"row",borderBottomWidth:1,borderStyle:"solid",borderColor:"#e0e0e0"},th:{flex:1,fontWeight:700,fontSize:11,padding:8,backgroundColor:"#f7f7f7"},td:{flex:1,padding:8,fontSize:11},right:{textAlign:"right"},small:{fontSize:10,color:"#555"},logo:{width:140,height:55,objectFit:"contain",marginBottom:0,marginTop:-20},companyDetails:{fontSize:9,color:"#555",lineHeight:1.4},sep:{height:8},footerNote:{marginTop:14,fontSize:9,color:"#555"},block:{marginTop:6},pastelGreen:{backgroundColor:"#e8f7ec"},strike:{textDecoration:"line-through",color:"#777"},itemCard:{backgroundColor:"#f5f6f8",borderRadius:8,padding:14,marginBottom:10,flexDirection:"row"},itemPhotoWrap:{width:170,height:170,backgroundColor:"transparent",borderRadius:6,alignItems:"center",justifyContent:"center",padding:6,position:"relative",marginRight:12},dimW:{position:"absolute",bottom:-18,left:0,right:0,textAlign:"center",fontSize:10,color:"#333",paddingVertical:3},dimHWrap:{position:"absolute",top:0,bottom:0,left:-20,alignItems:"center",justifyContent:"center"},dimH:{fontSize:10,color:"#333",transform:"rotate(-90deg)",paddingVertical:3,paddingHorizontal:3},photo:{width:"100%",height:"100%",objectFit:"contain"},itemContent:{flex:1,paddingLeft:14},itemHeader:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:6},itemKind:{fontSize:13,fontWeight:700,color:"#111"},itemDims:{fontSize:9,color:"#666",marginLeft:6},itemQty:{fontSize:11,color:"#555",fontWeight:500},itemDescription:{fontSize:9,color:"#666",marginBottom:4},itemRef:{fontSize:9,color:"#666",marginTop:2,marginBottom:6},hr:{height:1,backgroundColor:"#e0e0e0",marginVertical:12},detailGrid:{},detailRow:{flexDirection:"row",marginBottom:2,marginTop:6},detailLabel:{width:"45%",color:"#555",paddingRight:5,fontSize:11},detailValue:{flex:1,fontWeight:500,color:"#111",fontSize:11},piecesNote:{color:"#777",fontSize:10}});function $(t){const n=typeof t=="number"&&Number.isFinite(t)?t:0;return new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(n)}function x(t,n="—"){return typeof t=="string"&&t.trim().length>0?t:n}function ze(t){return t?/^\d{4}-\d{2}-\d{2}/.test(t)?t.slice(0,10):String(t):"—"}function Se(t){return(Array.isArray(t)?t:[]).map(a=>({category:x(a?.label??a?.category??"","-"),amount:typeof a?.amount=="number"&&Number.isFinite(a.amount)?a.amount:0,pieces:typeof a?.pieces=="number"&&Number.isFinite(a.pieces)&&a.pieces>0?a.pieces:null}))}function we(t){return Array.isArray(t)?t.filter(Boolean):t&&typeof t=="object"?Object.values(t).filter(Boolean):[]}function Ce(t){if(!t||typeof t!="object")return"";const n=t.width_mm||t.larghezza_mm||t.larghezza,a=t.height_mm||t.altezza_mm||t.altezza;return n&&a?`L ${n} × H ${a} mm`:n?`L ${n} mm`:a?`H ${a} mm`:""}function Te(t){switch(t){case"finestra":return ee;case"portafinestra":return _e;case"scorrevole":return je;case"zanzariera":return ye;case"cassonetto":return pe;case"persiana":return ue;case"tapparella":return he;default:return ee}}function h(t,n){for(const a of n)if(t[a]!==void 0&&t[a]!==null&&String(t[a]).toString().trim()!=="")return t[a]}function te(t,n="Sì",a="No"){if(typeof t=="boolean")return t?n:a;if(typeof t=="string"){const k=t.trim().toLowerCase();if(["si","sì","yes","true","1","on"].includes(k))return n;if(["no","false","0","off"].includes(k))return a}}function ke(t){if(!t||typeof t!="object")return[];const n=[],a=Number(t.width_mm??t.larghezza_mm??t.larghezza),k=Number(t.height_mm??t.altezza_mm??t.altezza),R=Number.isFinite(a)&&Number.isFinite(k)?a*k/1e6:void 0;switch(t.kind){case"finestra":case"portafinestra":case"scorrevole":{if(typeof R=="number"){const y=Number(t.qty),I=(Number.isFinite(y)?R*y:R).toFixed(2);n.push(["Superficie totale",`${I} m²`])}const c=h(t,["profile_system","system_profile"]);c&&n.push(["Sistema profilo",String(c)]);const l=h(t,["color","colore","profilo_colore"]);l&&n.push(["Colore",String(l)]);const u=h(t,["glass","vetro","glazing"]);let m=null;try{const y=t?.options?.gridWindow?.rows,F=typeof t?.options?.gridWindow?.glazing=="string"&&t.options.gridWindow.glazing.trim()?t.options.gridWindow.glazing.trim():null,I=typeof u=="string"&&String(u).trim()?String(u).trim():null;if(Array.isArray(y)&&y.length>0){const N={};for(const C of y){const T=Array.isArray(C?.cols)?C.cols:[];for(const d of T){const z=d?.leaf&&typeof d.leaf.glazing=="string"&&d.leaf.glazing.trim()?d.leaf.glazing.trim():typeof d?.glazing=="string"&&d.glazing.trim()?d.glazing.trim():F||I;if(z){const _=z.toLowerCase();N[_]=(N[_]||0)+1}}}const A=Object.entries(N);if(A.length>0){const C=["singolo","doppio","triplo","satinato"],T={singolo:"Singolo",doppio:"Doppio",triplo:"Triplo",satinato:"Satinato"};if(A.sort((d,z)=>{const _=C.indexOf(d[0].toLowerCase()),V=C.indexOf(z[0].toLowerCase());return _===-1&&V===-1?d[0].localeCompare(z[0]):_===-1?1:V===-1?-1:_-V}),A.length===1){const[d]=A[0];m=T[d.toLowerCase()]||d.charAt(0).toUpperCase()+d.slice(1)}else m=A.map(([d,z])=>`x${z} ${T[d.toLowerCase()]||d.charAt(0).toUpperCase()+d.slice(1)}`).join(", ")}}}catch{}!m&&u&&(m=String(u)),m&&n.push(["Vetro",m]);const p=h(t,["uw"]);if(p!=null&&String(p).trim()!==""){const y=Number(p),F=Number.isFinite(y)?`<= ${y} W/m²K`:`<= ${String(p)} W/m²K`;n.push(["Uw",F])}const B=h(t,["glass_spec","vetro_stratigrafia","stratigrafia_vetro"]);B&&n.push(["Stratigrafia vetro",String(B)]);const E=h(t,["hinge_color","colore_cerniere"]);E&&n.push(["Colore cerniere",String(E)]);break}case"zanzariera":{const c=h(t,["modello"]);c&&n.push(["Modello",String(c)]);const l=h(t,["tipologia"]);l&&n.push(["Tipologia",String(l)]);const u=h(t,["rete_colore","rete_tipo","tipo_rete","mesh"]);if(u){const p=String(u).replace(/^mesh\s*/i,"").trim();n.push(["Colore rete",p])}const m=te(h(t,["deceleratore","has_deceleratore","con_deceleratore"]));m&&n.push(["Deceleratore",m]);break}case"cassonetto":{const c=h(t,["material","materiale"]);c&&n.push(["Materiale",String(c)]);const l=h(t,["depth_mm","profondita_mm","profondità_mm"]);l&&n.push(["Profondità",`${l} mm`]);const u=h(t,["spalletta_mm","extension_mm","spalletta"]);u&&n.push(["Celino",`${u} mm`]);const m=h(t,["color","colore"]);m&&n.push(["Colore",String(m)]);break}case"persiana":{n.push(["Materiale","Alluminio"]);const c=h(t,["lamelle_type","lamelle"]);c&&n.push(["Lamelle",String(c)]);const l=te(h(t,["con_telaio","telaio"]),"Con telaio","Senza telaio");l&&n.push(["Telaio",l]);const u=h(t,["color","colore"]);u&&n.push(["Colore",String(u)]);break}case"tapparella":{const c=h(t,["material","materiale"]);c&&n.push(["Materiale",String(c)]);const l=h(t,["color","colore"]);l&&n.push(["Colore",String(l)]);break}case"custom":{const c=h(t,["label","title"]);c&&n.push(["Titolo",String(c)]);const l=h(t,["note","descrizione"]);l&&n.push(["Note",String(l)]);break}}const P=new Set(n.map(([c])=>c.toLowerCase())),b=new Set(["id","kind","qty","width_mm","height_mm","larghezza_mm","altezza_mm","larghezza","altezza","price_mode","price_total","price_per_mq","unit_price","unitPrice","price","prezzo","misura_tipo","accessori_colore","reference","riferimento","image_url","imageUrl"]);for(const[c,l]of Object.entries(t)){if(l==null||String(l).trim()===""||typeof l=="object"||typeof l=="function"||b.has(c))continue;const m={profile_system:"Sistema profilo",system_profile:"Sistema profilo",color:"Colore",colore:"Colore",profilo_colore:"Colore profilo",glass:"Vetro",vetro:"Vetro",glazing:"Vetro",uw:"Uw",modello:"Modello",tipologia:"Tipologia",rete_colore:"Colore rete",rete_tipo:"Colore rete",tipo_rete:"Colore rete",mesh:"Colore rete",deceleratore:"Deceleratore",has_deceleratore:"Deceleratore",con_deceleratore:"Deceleratore",material:"Materiale",materiale:"Materiale",depth_mm:"Profondità",profondita_mm:"Profondità",spalletta_mm:"Celino",extension_mm:"Celino",lamelle_type:"Lamelle",lamelle:"Lamelle",con_telaio:"Telaio",hinge_color:"Colore cerniere",hinges_color:"Colore cerniere",glass_spec:"Stratigrafia vetro",vetro_stratigrafia:"Stratigrafia vetro",stratigrafia_vetro:"Stratigrafia vetro"}[c]||c;if(!P.has(m.toLowerCase())){let p=String(l);(m==="Profondità"||m==="Spalletta"||m==="Celino")&&(/mm\b/i.test(p)||(p=`${p} mm`)),m==="Colore rete"&&(p=p.replace(/^mesh\s*/i,"").trim()),n.push([m,p]),P.add(m.toLowerCase())}}return n}function We(t){const{companyLogoUrl:n,quoteNumber:a,issueDate:k,installTime:R,profileSystem:P,customer:b,catTotals:c,mountingCost:l,totalExcluded:u,validityLabel:m,validityDays:p,terms:B,items:E}=t||{},y=we(E),F=y.some(o=>{const g=String(o?.kind||"").toLowerCase();return g==="finestra"||g==="portafinestra"||g==="scorrevole"||/serrament/i.test(g)}),I=y.reduce((o,g)=>{const S=String(g?.kind||"").toLowerCase();if(!["finestra","portafinestra","scorrevole"].includes(S))return o;const D=Number(g?.width_mm??g?.larghezza_mm??g?.larghezza),L=Number(g?.height_mm??g?.altezza_mm??g?.altezza),j=Number(g?.qty??1);if(Number.isFinite(D)&&Number.isFinite(L)){const H=D*L/1e6;return o+(Number.isFinite(j)?H*j:H)}return o},0),N=Se(c),A=typeof l=="number"&&Number.isFinite(l)?l:0,C=N.reduce((o,g)=>o+g.amount,0)+A,T=!!(t?.discount&&typeof t.discount.discountedTotal=="number"&&t.discount.discountedTotal>=0&&t.discount.discountedTotal<(t.discount.originalTotal??1/0)),d=T?t.discount?.originalTotal??C:typeof u=="number"&&Number.isFinite(u)?u:C,z=T?t.discount.discountedTotal:d,_=typeof p=="number"&&isFinite(p)?`VALIDITÀ OFFERTA: ${p} giorni`:x(m),V=_&&_!=="—"?_.replace(/VALIDIT[ÀA][’']?\s*OFFERTA\s*:\s*/i,"").trim():"—";return e.jsxs(xe,{children:[e.jsxs(q,{size:"A4",style:r.page,children:[e.jsxs(s,{style:[r.row,{alignItems:"flex-start",justifyContent:"space-between"}],children:[e.jsxs(s,{style:{flexGrow:1,flexBasis:0,paddingRight:12},children:[n&&n.trim()?e.jsx(v,{src:n,style:r.logo}):e.jsx(v,{src:K,style:r.logo}),e.jsxs(i,{style:r.companyDetails,children:["X S.R.L.",`
`,"P.IVA 04062850120",`
`,"sede legale - Saronno (VA) 21047",`
`,"Via San Giuseppe, 95",`
`,"info@xinfissi.it · www.xinfissi.it · +39 345 457 3328"]})]}),e.jsxs(s,{style:{width:300,marginTop:0},children:[e.jsx(i,{style:r.h2Tight,children:"Spettabile"}),e.jsx(i,{children:x(b?.name)}),x(b?.address,"")!==""?e.jsx(i,{children:x(b?.address)}):null,(()=>{const o=[x(b?.email,""),x(b?.phone,""),b?.vat&&b.vat.trim()?`P.IVA ${b.vat.trim()}`:""].filter(g=>g&&g.trim()!=="");return o.length>0?e.jsx(i,{style:r.small,children:o.join(" · ")}):null})()]})]}),e.jsxs(s,{style:r.block,children:[e.jsxs(i,{style:r.h2,children:["Offerta n° ",x(a,"-")]}),e.jsxs(s,{style:[r.box],children:[e.jsxs(s,{style:r.row,children:[e.jsxs(s,{style:{flex:1,paddingRight:8},children:[e.jsx(i,{style:r.label,children:"Data emissione preventivo"}),e.jsx(i,{wrap:!1,children:ze(k)})]}),e.jsxs(s,{style:{flex:1,paddingLeft:8},children:[e.jsx(i,{style:r.label,children:"Validità offerta"}),e.jsx(i,{wrap:!1,children:V})]})]}),e.jsxs(s,{style:[r.row,{marginTop:6}],children:[e.jsxs(s,{style:{flex:1,paddingRight:8},children:[e.jsx(i,{style:r.label,children:"Termini di completamento"}),e.jsx(i,{wrap:!1,children:x(R)})]}),e.jsxs(s,{style:{flex:1,paddingLeft:8},children:[e.jsx(i,{style:r.label,children:"Sistema profilo"}),e.jsx(i,{wrap:!1,children:x(P)})]})]}),F&&e.jsxs(s,{style:[r.row,{marginTop:6}],children:[e.jsxs(s,{style:{flex:1,paddingRight:8},children:[e.jsx(i,{style:r.label,children:"Ferramenta"}),e.jsx(i,{wrap:!1,children:"WINKHAUS + HOPPE"})]}),e.jsxs(s,{style:{flex:1,paddingLeft:8},children:[e.jsx(i,{style:r.label,children:"Servizi"}),e.jsx(i,{wrap:!1,children:"Trasporto incluso"})]})]})]})]}),e.jsxs(s,{style:r.block,children:[e.jsx(i,{style:r.h2,children:"Riepilogo preventivo"}),e.jsxs(s,{style:r.table,children:[e.jsxs(s,{style:r.tr,children:[e.jsx(i,{style:[r.th,{flex:2}],children:"Categoria"}),e.jsx(i,{style:[r.th,r.right],children:"Importo"})]}),N.length>0?N.map((o,g)=>{const S=x(o.category,"-"),D=`row-${S}-${Number.isFinite(o.amount)?o.amount:0}-${g}`,L=/finestr|serramenti/i.test(S)&&I>0,j=o.pieces;return e.jsxs(s,{style:r.tr,children:[e.jsxs(i,{style:[r.td,{flex:2}],children:[e.jsx(i,{children:S}),typeof j=="number"&&j>0?e.jsxs(i,{style:r.piecesNote,children:[" · ",j," pezzi "]}):null,L?e.jsxs(i,{style:r.piecesNote,children:[" · ",I.toFixed(2)," m²"]}):null]}),e.jsx(i,{style:[r.td,r.right],children:$(o.amount)})]},D)}):e.jsxs(s,{style:r.tr,children:[e.jsx(i,{style:[r.td,{flex:2,color:"#777"}],children:"—"}),e.jsx(i,{style:[r.td,r.right,{color:"#777"}],children:"—"})]}),typeof l=="number"&&Number.isFinite(l)&&e.jsxs(s,{style:r.tr,children:[e.jsx(i,{style:[r.td,{flex:2}],children:"Montaggio"}),e.jsx(i,{style:[r.td,r.right],children:$(l)})]}),T?e.jsxs(e.Fragment,{children:[e.jsxs(s,{style:[r.tr],children:[e.jsx(i,{style:[r.td,{flex:2,fontWeight:700,backgroundColor:"#f7f7f7"}],children:"TOTALE (IVA ESCLUSA)"}),e.jsx(i,{style:[r.td,r.right,{fontWeight:700,backgroundColor:"#f7f7f7"}],children:$(d)})]}),e.jsxs(s,{style:[r.tr,r.pastelGreen,{borderBottomWidth:0}],children:[e.jsx(i,{style:[r.td,{flex:2,fontWeight:700}],children:`TOTALE SCONTATO (IVA ESCLUSA)${t.discount?.mode==="pct"&&typeof t.discount?.pct=="number"&&t.discount.pct>0?` (${t.discount.pct}%)`:""}`}),e.jsx(i,{style:[r.td,r.right,{fontWeight:700}],children:$(z)})]})]}):e.jsxs(s,{style:[r.tr,{borderBottomWidth:0}],children:[e.jsx(i,{style:[r.td,{flex:2,fontWeight:700,backgroundColor:"#f7f7f7"}],children:"TOTALE (IVA ESCLUSA)"}),e.jsx(i,{style:[r.td,r.right,{fontWeight:700,backgroundColor:"#f7f7f7"}],children:$(d)})]})]})]})]}),e.jsxs(q,{size:"A4",style:r.page,children:[n&&n.trim()?e.jsx(v,{src:n,style:r.logo}):e.jsx(v,{src:K,style:r.logo}),e.jsxs(s,{style:r.block,children:[e.jsx(i,{style:r.h2,children:"Dettaglio voci"}),y.length>0?y.map((o,g)=>{const S=o?.kind==="custom",D=S?[]:ke(o),L=Array.isArray(o?.custom_fields)?o.custom_fields.filter(f=>{const w=f?.name??f?.label??f?.key,W=f?.value;return w&&String(w).trim()&&W!=null&&String(W).trim()}).map(f=>[String(f?.name??f?.label??f?.key).trim(),String(f?.value).trim()]):[],j=S?L:[...D,...L],H=S?String(o?.title||o?.label||"Voce personalizzata").trim():String(o?.kind||"Voce").toUpperCase(),re=`Q.tà ${Number.isFinite(Number(o?.qty))?String(o.qty):"1"}`,oe=Ce(o),ie=j.length,ne=Math.max(260,80+Math.min(40,ie*7)),Q=typeof o?.reference=="string"&&o.reference.trim()?o.reference.trim():typeof o?.riferimento=="string"&&o.riferimento.trim()?o.riferimento.trim():"";return e.jsxs(s,{wrap:!1,style:[r.itemCard,{minHeight:ne}],children:[e.jsxs(s,{style:r.itemPhotoWrap,children:[(()=>{const f=typeof o?.image_url=="string"?o.image_url:"",w=f&&!f.startsWith("blob:")?f:Te(o?.kind);return e.jsx(v,{src:w,style:r.photo})})(),(()=>{const f=String(o?.kind||"").toLowerCase(),w=o?.width_mm??o?.larghezza_mm??o?.larghezza?`${String(o?.width_mm??o?.larghezza_mm??o?.larghezza)} mm`:"—",W=o?.height_mm??o?.altezza_mm??o?.altezza?`${String(o?.height_mm??o?.altezza_mm??o?.altezza)} mm`:"—";if(!(f==="finestra"||f==="cassonetto"))return e.jsxs(e.Fragment,{children:[e.jsx(i,{style:r.dimW,children:w}),e.jsx(s,{style:r.dimHWrap,children:e.jsx(i,{style:r.dimH,children:W})})]});const X=170,se=170,O=6,Y=X-O*2,M=se-O*2,G=Number(o?.width_mm??o?.larghezza_mm??o?.larghezza),U=Number(o?.height_mm??o?.altezza_mm??o?.altezza),le=Number.isFinite(G)&&Number.isFinite(U)&&G>0&&U>0;let J=0;if(le){const Z=G/U,ge=Y/M;if(Z>=ge){const fe=Y/Z;J=Math.max(0,(M-fe)/2)}}const ae=4,ce=X/2,me=O+M/2,de=O+(M-J)+ae;return e.jsxs(e.Fragment,{children:[e.jsx(i,{style:{position:"absolute",top:de,left:ce-60,width:120,textAlign:"center",fontSize:10,color:"#333"},children:w}),e.jsx(s,{style:{position:"absolute",left:-22,top:me,transform:"rotate(-90deg)"},children:e.jsx(i,{style:{fontSize:10,color:"#333"},children:W})})]})})()]}),e.jsxs(s,{style:r.itemContent,children:[e.jsxs(s,{style:r.itemHeader,children:[e.jsxs(s,{style:{flexDirection:"row",alignItems:"center",flexShrink:1},children:[e.jsx(i,{style:r.itemKind,children:H}),(()=>{const f=oe;return f?e.jsxs(i,{style:r.itemDims,children:["· ",f]}):null})()]}),e.jsx(i,{style:r.itemQty,children:re})]}),Q?e.jsx(i,{style:r.itemRef,children:Q}):null,j.length>0&&e.jsx(s,{style:r.hr}),e.jsx(s,{style:r.detailGrid,children:j.map(([f,w],W)=>e.jsxs(s,{style:r.detailRow,children:[e.jsx(i,{style:r.detailLabel,children:f}),e.jsx(i,{style:r.detailValue,children:w})]},`kv-${W}`))})]})]},`card-${o?.id||o?.kind||"k"}-${g}`)}):e.jsx(s,{style:[r.itemCard,{justifyContent:"center"}],children:e.jsx(i,{style:{color:"#666"},children:"— Nessuna voce inserita —"})})]})]}),e.jsxs(q,{size:"A4",style:r.page,children:[n&&n.trim()?e.jsx(v,{src:n,style:r.logo}):e.jsx(v,{src:K,style:r.logo}),e.jsx(i,{style:[r.h2,{marginTop:6}],children:"Condizioni di Fornitura"}),e.jsx(s,{style:{height:1,backgroundColor:"#eee",marginVertical:10}}),e.jsx(i,{children:x(B)}),e.jsxs(s,{style:{marginTop:22},children:[e.jsx(i,{children:"Letto e confermato in ______________________ in data _____________________"}),e.jsx(s,{style:{height:28}}),e.jsxs(s,{style:r.row,children:[e.jsxs(s,{style:[r.col],children:[e.jsx(i,{children:"Cliente"}),e.jsx(s,{style:{height:40,borderBottomWidth:1,borderStyle:"solid",borderColor:"#e6e6e6",marginRight:18}})]}),e.jsxs(s,{style:[r.col],children:[e.jsx(i,{children:"Fornitore"}),e.jsx(s,{style:{height:40,borderBottomWidth:1,borderStyle:"solid",borderColor:"#e6e6e6",marginRight:18}})]})]})]})]})]})}export{We as default};
